<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ejercicio 3 Corregido</title>
<script>
    // 1. Esta función hace la petición y devuelve una promesa
    const hacerpromesa = async function(url) {
        const response = await fetch(url);
        if (!response.ok) throw new Error("WARN " + response.status);
        const data = await response.text();
        return data; // Devuelve el texto final
    }

    // 2. CORRECCIÓN IMPORTANTE AQUÍ:
    // Añadimos 'async' a esta función para poder usar 'await' dentro
    async function LlamarPromesa() {
        try {
            // Añadimos 'await' para que el código SE PARE aquí hasta recibir los datos
            const data = await hacerpromesa('hola.php');
            
            // Ahora 'data' ya tiene el texto, no la promesa
            document.getElementById("cosas").innerHTML += "solicitada descarga <br>" + data + "<hr>";
        } catch (error) {
            console.error(error);
            document.getElementById("cosas").innerHTML += "Error: " + error.message;
        }
    }
</script>
</head>
<body>
    <h3>Ejercicio 3: Async/Await</h3>
    <button onclick="LlamarPromesa()"> Cargar PHP </button>
    <div id="cosas"> </div>
</body>
</html>