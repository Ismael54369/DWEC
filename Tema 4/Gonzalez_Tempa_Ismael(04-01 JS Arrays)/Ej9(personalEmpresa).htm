<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicio 9</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <div class="card">
            <div class="card-header">
                <h1 class="card-title">Gestión de Personal de la Empresa</h1>
            </div>
            <div class="card-body">
                <!-- Formulario de entrada de datos -->
                <div class="row g-3">
                    <div class="col-md-4">
                        <label for="id" class="form-label">ID del Empleado</label>
                        <input type="text" class="form-control" id="id" placeholder="Ej: 12345">
                    </div>
                    <div class="col-md-4">
                        <label for="nombre" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="nombre" placeholder="Ej: Ana">
                    </div>
                    <div class="col-md-4">
                        <label for="apellido" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="apellido" placeholder="Ej: García">
                    </div>
                    <div class="col-md-6">
                        <label for="fechaNacimiento" class="form-label">Fecha de Nacimiento</label>
                        <input type="date" class="form-control" id="fechaNacimiento">
                    </div>
                    <div class="col-md-6">
                        <label for="puesto" class="form-label">Puesto</label>
                        <input type="text" class="form-control" id="puesto" placeholder="Ej: Desarrollador/a">
                    </div>
                </div>

                <hr>

                <!-- Botones de acción -->
                <div class="d-flex flex-wrap gap-2 justify-content-center">
                    <button class="btn btn-success" onclick="insertarDatos()">Insertar Datos</button>
                    <button class="btn btn-info" onclick="mostrarDatos()">Mostrar Plantilla</button>
                    <button class="btn btn-warning" onclick="aniosActivos()">Calcular Jubilación</button>
                    <div class="input-group w-auto">
                        <input type="text" id="idBusqueda" class="form-control" placeholder="ID a buscar...">
                        <button class="btn btn-primary" onclick="mostrarRegistro()">Mostrar un Registro</button>
                    </div>
                </div>

                <hr />

                <!-- Área de resultados -->
                <h5 class="card-subtitle mt-4 mb-2 text-muted">Resultados:</h5>
                <div id="resultados" class="border p-3 rounded bg-light">
                    <p>Aquí se mostrarán los resultados de las operaciones.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Array global para almacenar los datos del personal
        const personal = [];

        /**
         * Inserta un nuevo empleado en el array 'personal' tras validar los datos.
         */
        function insertarDatos() {
            const id = document.getElementById('id').value.trim();
            const nombre = document.getElementById('nombre').value.trim();
            const apellido = document.getElementById('apellido').value.trim();
            const fechaNacimiento = document.getElementById('fechaNacimiento').value;
            const puesto = document.getElementById('puesto').value.trim();

            // Validación de entradas
            if (!id || !nombre || !apellido || !fechaNacimiento || !puesto) {
                alert("Por favor, completa todos los campos.");
                return;
            }

            // Verificamos que el ID no exista previamente
            if (personal.some(empleado => empleado.id === id)) {
                alert(`El ID '${id}' ya existe. Por favor, introduce un ID único.`);
                return;
            }

            // Creamos el objeto empleado y lo añadimos al array
            const empleado = { id, nombre, apellido, fechaNacimiento, puesto };
            personal.push(empleado);

            // Limpiamos el formulario y mostramos un mensaje de éxito
            alert(`Empleado ${nombre} ${apellido} añadido correctamente.`);
            document.getElementById('id').value = '';
            document.getElementById('nombre').value = '';
            document.getElementById('apellido').value = '';
            document.getElementById('fechaNacimiento').value = '';
            document.getElementById('puesto').value = '';
        }

        /**
         * Muestra todos los empleados en una lista multinivel.
         */
        function mostrarDatos() {
            const resultadosDiv = document.getElementById('resultados');
            if (personal.length === 0) {
                resultadosDiv.innerHTML = "<p>No hay empleados registrados en la plantilla.</p>";
                return;
            }

            let html = '<ul>';
            for (const empleado of personal) {
                html += `<li><strong>${empleado.nombre} ${empleado.apellido}</strong>
                            <ul>
                                <li>ID: ${empleado.id}</li>
                                <li>Fecha de Nacimiento: ${new Date(empleado.fechaNacimiento).toLocaleDateString()}</li>
                                <li>Puesto: ${empleado.puesto}</li>
                            </ul>
                         </li>`;
            }
            html += '</ul>';
            resultadosDiv.innerHTML = html;
        }

        /**
         * Busca y muestra los datos de un empleado específico por su ID.
         */
        function mostrarRegistro() {
            const idBusqueda = document.getElementById('idBusqueda').value.trim();
            if (!idBusqueda) {
                alert("Introduce un ID para buscar.");
                return;
            }

            const empleado = personal.find(emp => emp.id === idBusqueda);
            const resultadosDiv = document.getElementById('resultados');

            if (empleado) {
                resultadosDiv.innerHTML = `<p><strong>Datos de ${empleado.nombre} ${empleado.apellido}:</strong></p>
                                           <ul>
                                               <li>ID: ${empleado.id}</li>
                                               <li>Fecha de Nacimiento: ${new Date(empleado.fechaNacimiento).toLocaleDateString()}</li>
                                               <li>Puesto: ${empleado.puesto}</li>
                                           </ul>`;
            } else {
                resultadosDiv.innerHTML = `<p>No se encontró ningún empleado con el ID '${idBusqueda}'.</p>`;
            }
        }

        /**
         * Calcula y muestra los días que le quedan a cada trabajador para su jubilación (67 años).
         */
        function aniosActivos() {
            const resultadosDiv = document.getElementById('resultados');
            if (personal.length === 0) {
                resultadosDiv.innerHTML = "<p>No hay empleados para calcular.</p>";
                return;
            }

            const EDAD_JUBILACION = 67;
            const hoy = new Date();
            const msPorDia = 1000 * 60 * 60 * 24;

            let html = '<ul>';
            for (const empleado of personal) {
                const fechaNac = new Date(empleado.fechaNacimiento);
                const fechaJubilacion = new Date(fechaNac.getFullYear() + EDAD_JUBILACION, fechaNac.getMonth(), fechaNac.getDate());

                if (fechaJubilacion < hoy) {
                    html += `<li><strong>${empleado.nombre} ${empleado.apellido}</strong> ya ha alcanzado la edad de jubilación.</li>`;
                } else {
                    const diasRestantes = Math.floor((fechaJubilacion - hoy) / msPorDia);
                    html += `<li>A <strong>${empleado.nombre} ${empleado.apellido}</strong> le quedan <strong>${diasRestantes}</strong> días para su jubilación.</li>`;
                }
            }
            html += '</ul>';
            resultadosDiv.innerHTML = html;
        }
    </script>
</body>
</html>
