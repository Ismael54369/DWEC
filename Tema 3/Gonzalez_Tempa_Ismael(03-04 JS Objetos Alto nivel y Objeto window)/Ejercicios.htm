<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicios Objeto Window</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <script type="text/javascript">
        let nuevaVentana;
        let intervalId = null;
        let zoomLevel = 15;
        const GEO_API_KEY = "PON_AQUI_TU_API_KEY"; // IMPORTANTE: Reemplaza con tu API Key de Google

        function crearVentanaEj1() {
            const altura = parseInt(prompt("Introduce la altura de la nueva ventana"));
            const ancho = parseInt(prompt("Introduce el ancho de la nueva ventana"));

            if (isNaN(altura) || isNaN(ancho) || altura <= 0 || ancho <= 0) {
                document.getElementById("text").innerHTML = "Introduce valores validos porfavor.";
            } else {
                nuevaVentana = window.open("nueva.html", "nueva", `height=${altura},width=${ancho}`);
            }
        }

        function cerrarVentanaComun() {
            if (nuevaVentana && !nuevaVentana.closed) {
                nuevaVentana.close();
                document.getElementById("text").innerHTML = "La ventana ha sido cerrada.";
            } else {
                document.getElementById("text").innerHTML = "No hay ninguna ventana abierta para cerrar.";
            }
        }

        function estaAbiertaEj3() {
            if (!nuevaVentana || nuevaVentana.closed) {
                document.getElementById("text").innerHTML = "La ventana está cerrada o no se ha creado.";
            } else {
                document.getElementById("text").innerHTML = "La ventana está abierta.";
            }
        }

        function crearVentanaEj4() {
            const url = prompt("Introduce la URL de la nueva ventana (ej: https://es.wikipedia.org/wiki/Wikipedia:Portada)");
            if (!url) {
                document.getElementById("text").innerHTML = "Operación cancelada. Por favor, introduce una URL válida.";
            } else {
                nuevaVentana = window.open(url, "nueva", "height=400,width=600");
                document.getElementById("text").innerHTML = `Propiedades de la nueva ventana:<br>
                - <b>Name:</b> ${nuevaVentana.name}<br>
                - <b>Length (frames):</b> ${nuevaVentana.length}<br>
                - <b>Location:</b> ${nuevaVentana.location}`;
            }
        }
            
        function ejecutarEj5() { 
            const alerta = window.alert("ALERTA, te están robando el banco");
            const confirmacion = window.confirm("¿Estás de acuerdo?");
            if (confirmacion) {
                document.getElementById("text").textContent = "Estás de acuerdo.";
            } else {
                document.getElementById("text").textContent = "No estás de acuerdo.";
            }
        }

        function ejecutarEj6() { 
            if (intervalId) {
                clearInterval(intervalIdEj6);
                intervalId = null;
            } else {
                function dihola() {
                document.getElementById("text").textContent += "Hola ";
            }
                intervalId = setInterval(dihola, 500);
                document.getElementById("text").textContent = "Intervalo iniciado. ";
            }
        }

        function parar() {
            clearInterval(intervalId);
            intervalId = null;
            document.getElementById("text").textContent = "Intervalo detenido.";
        }

        function ejecutarEj7() { 
            const date = new Date();
            if (intervalId) {
                clearInterval(intervalIdEj6);
                intervalId = null;
            } else {
                function hora() {
                const date = new Date();
                document.getElementById("text").textContent = "Hola son las " + date.toLocaleTimeString();
            }
                intervalId = setInterval(hora, 1000);
                document.getElementById("text").textContent = "Intervalo iniciado. ";
            }
         }

        function mostrarLocation() {
            const loc = window.location;
            document.getElementById("text").innerHTML = `
                <h3>Propiedades del Objeto <code>location</code>:</h3>
                <ul>
                    <li><b>hash:</b> ${loc.hash}</li>
                    <li><b>host:</b> ${loc.host}</li>
                    <li><b>hostname:</b> ${loc.hostname}</li>
                    <li><b>href:</b> ${loc.href}</li>
                    <li><b>pathname:</b> ${loc.pathname}</li>
                    <li><b>port:</b> ${loc.port}</li>
                    <li><b>protocol:</b> ${loc.protocol}</li>
                    <li><b>search:</b> ${loc.search}</li>
                </ul>`;
        }

        function cargarNuevaURL(metodo) {
            const url = document.getElementById("urlInput") ? document.getElementById("urlInput").value : prompt("Introduce la URL a cargar (ej: https://www.iesplayamar.es):");
            if (url) {
                if (metodo === 'assign') {
                    location.assign(url);
                } else if (metodo === 'replace') {
                    location.replace(url);
                }
            } else {
                document.getElementById("text").textContent = "URL no válida o cancelada.";
            }
        }

        function recargarPagina() {
            location.reload();
        }

        function mostrarNavigator() {
            const nav = window.navigator;
            document.getElementById("text").innerHTML = `
                <h3>Propiedades del Objeto <code>navigator</code>:</h3>
                <ul>
                    <li><b>appCodeName:</b> ${nav.appCodeName}</li>
                    <li><b>appName:</b> ${nav.appName}</li>
                    <li><b>appVersion:</b> ${nav.appVersion}</li>
                    <li><b>cookieEnabled:</b> ${nav.cookieEnabled}</li>
                    <li><b>platform:</b> ${nav.platform}</li>
                    <li><b>userAgent:</b> ${nav.userAgent}</li>
                </ul>`;
        }

        function obtenerGeolocalizacion() {
            const demo = document.getElementById("text");
            if (navigator.geolocation) {
                demo.innerHTML = "Pidiendo permiso para obtener ubicación...";
                navigator.geolocation.getCurrentPosition(
                    (position) => { // Éxito
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        demo.innerHTML = `
                            <b>Latitud:</b> ${lat}<br>
                            <b>Longitud:</b> ${lon}<br><br>
                            <iframe id="mapa"
                                width="600"
                                height="450"
                                style="border:0"
                                loading="lazy"
                                allowfullscreen
                                src="https://www.google.com/maps/embed/v1/view?key=${GEO_API_KEY}&center=${lat},${lon}&zoom=${zoomLevel}">
                            </iframe>`;
                    },
                    (error) => { // Error
                        let mensajeError = "Error al obtener la geolocalización: ";
                        switch(error.code) {
                            case error.PERMISSION_DENIED:
                                mensajeError += "El usuario denegó la solicitud.";
                                break;
                            case error.POSITION_UNAVAILABLE:
                                mensajeError += "La información de ubicación no está disponible.";
                                break;
                            case error.TIMEOUT:
                                mensajeError += "La solicitud de ubicación ha caducado.";
                                break;
                            default:
                                mensajeError += "Ocurrió un error desconocido.";
                                break;
                        }
                        demo.innerHTML = mensajeError;
                    }
                );
            } else {
                demo.innerHTML = "La geolocalización no es soportada por este navegador.";
            }
        }

        function cambiarZoom(direccion) {
            const mapaFrame = document.getElementById("mapa");
            if (!mapaFrame) {
                document.getElementById("text").innerHTML = "Primero debes cargar el mapa.";
                return;
            }
            if (direccion === 'mas') {
                zoomLevel++;
            } else if (direccion === 'menos' && zoomLevel > 1) {
                zoomLevel--;
            }
            const nuevaSrc = mapaFrame.src.replace(/&zoom=\d+/, `&zoom=${zoomLevel}`);
            mapaFrame.src = nuevaSrc;
        }

        function setupEjercicio(num) {
            const controlesDiv = document.getElementById("controles-ejercicio");
            const titulo = document.getElementById("titulo-ejercicio");
            const textoResultado = document.getElementById("text");
            textoResultado.innerHTML = "";

            let htmlControles = "";

            switch (num) {
                case 1:
                    titulo.textContent = "Ejercicio 1 - Crear Ventana";
                    htmlControles = `<button onclick="crearVentanaEj1()" class="btn btn-primary me-2">Crear ventana</button>`;
                    break;
                case 2:
                    titulo.textContent = "Ejercicio 2 - Cerrar Ventana";
                    htmlControles = `<button onclick="crearVentanaEj1()" class="btn btn-primary me-2">Crear ventana primero</button>
                                     <button onclick="cerrarVentanaComun()" class="btn btn-danger">Cerrar ventana</button>`;
                    break;
                case 3:
                    titulo.textContent = "Ejercicio 3 - ¿Ventana Abierta?";
                    htmlControles = `<button onclick="crearVentanaEj1()" class="btn btn-primary me-2">Crear ventana</button>
                                     <button onclick="estaAbiertaEj3()" class="btn btn-success me-2">¿Está abierta?</button>
                                     <button onclick="cerrarVentanaComun()" class="btn btn-danger">Cerrar ventana</button>`;
                    break;
                case 4:
                    titulo.textContent = "Ejercicio 4 - Propiedades de Ventana";
                    htmlControles = `<button onclick="crearVentanaEj4()" class="btn btn-primary me-2">Crear y ver propiedades</button>
                                     <button onclick="cerrarVentanaComun()" class="btn btn-danger">Cerrar ventana</button>`;
                    break;
                case 5:
                    titulo.textContent = "Ejercicio 5 - Alerta y Confirmación";
                    htmlControles = `<button onclick="ejecutarEj5()" class="btn btn-primary">Alertar</button>`;
                    break;
                case 6:
                    titulo.textContent = "Ejercicio 6 - setInterval y clearInterval";
                    htmlControles = `<button onclick="ejecutarEj6()" class="btn btn-success me-2">Iniciar 'Hola'</button>
                                     <button onclick="parar()" class="btn btn-danger">Detener</button>`;
                    break;
                case 7:
                    titulo.textContent = "Ejercicio 7 - Hora";
                    htmlControles = `<button onclick="ejecutarEj7()" class="btn btn-success me-2">Iniciar recuento de hora</button>
                                     <button onclick="parar()" class="btn btn-danger">Detener</button>`;
                    break;
                case 8:
                    titulo.textContent = "Ejercicio 8 - Objeto Location";
                    htmlControles = `<button onclick="mostrarLocation()" class="btn btn-info">Mostrar Propiedades de Location</button>`;
                    textoResultado.innerHTML = `Pulsa el botón para ver las propiedades del objeto <code>location</code> de esta página.`;
                    break;
                case 9:
                    titulo.textContent = "Ejercicio 9 - assign, replace y reload";
                    htmlControles = `<div class="input-group mb-3" style="max-width: 400px;">
                                        <input type="text" id="urlInput" class="form-control" placeholder="https://www.iesplayamar.es">
                                     </div>
                                     <button onclick="cargarNuevaURL('assign')" class="btn btn-primary me-2">Cargar con assign()</button>
                                     <button onclick="cargarNuevaURL('replace')" class="btn btn-warning me-2">Cargar con replace()</button>
                                     <button onclick="recargarPagina()" class="btn btn-secondary">Recargar con reload()</button>`;
                    textoResultado.innerHTML = `<b>assign()</b>: Carga una nueva URL y la añade al historial (puedes volver atrás).<br>
                                                <b>replace()</b>: Carga una nueva URL pero reemplaza la página actual en el historial (no puedes volver atrás).<br>
                                                <b>reload()</b>: Recarga la página actual.`;
                    break;
                case 10:
                    titulo.textContent = "Ejercicio 10 - Objeto Navigator";
                    htmlControles = `<button onclick="mostrarNavigator()" class="btn btn-info">Mostrar Propiedades de Navigator</button>`;
                    break;
                case 11:
                    titulo.textContent = "Ejercicio 11 - Geolocalización y Mapas";
                    htmlControles = `<button onclick="obtenerGeolocalizacion()" class="btn btn-primary me-2">Obtener Ubicación y Mostrar Mapa</button>
                                     <button onclick="cambiarZoom('mas')" class="btn btn-success me-2">Zoom +</button>
                                     <button onclick="cambiarZoom('menos')" class="btn btn-danger">Zoom -</button>`;
                    textoResultado.innerHTML = `<b>IMPORTANTE:</b> Para que este ejercicio funcione, debes reemplazar el texto <i>"PON_AQUI_TU_API_KEY"</i> en el código JS por una API Key válida de Google Maps.`;
                    break;
            }
            controlesDiv.innerHTML = htmlControles;
        }

        function inicializar() {
            setupEjercicio(1);
        }
    </script>
</head>
<body onload="inicializar()">
    <div class="container mt-4">
        <header class="p-3 mb-4 bg-light rounded-3">
            <h1 class="display-5">Ejercicios con el Objeto Window</h1>
            <p class="lead">Selecciona un ejercicio del menú para ver su funcionamiento.</p>
        </header>

        <div class="mb-4">
            <label for="select-ejercicio" class="form-label fw-bold">Seleccionar Ejercicio:</label>
            <select id="select-ejercicio" class="form-select w-auto" onchange="setupEjercicio(parseInt(this.value))">
                <option value="1">Ejercicio 1: Crear Ventana</option>
                <option value="2">Ejercicio 2: Cerrar Ventana</option>
                <option value="3">Ejercicio 3: Comprobar si está abierta</option>
                <option value="4">Ejercicio 4: Propiedades de la ventana</option>
                <option value="5">Ejercicio 5: Alerta y Confirmación</option>
                <option value="6">Ejercicio 6: setInterval y clearInterval</option>
                <option value="7">Ejercicio 7: Hora</option>
                <option value="8">Ejercicio 8: Objeto Location</option>
                <option value="9">Ejercicio 9: assign, replace y reload</option>
                <option value="10">Ejercicio 10: Objeto Navigator</option>
                <option value="11">Ejercicio 11: Geolocalización y Mapas</option>
            </select>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 id="titulo-ejercicio" class="h4 mb-0"></h2>
            </div>
            <div class="card-body">
                <div id="controles-ejercicio" class="d-flex flex-wrap justify-content-center align-items-center mb-3">
                </div>
                <div class="d-flex justify-content-center mt-3">
                    <p><span id="text" class="fw-bold"></span></p>
                </div>
            </div>
        </div>
    </div>
</body>
</html>